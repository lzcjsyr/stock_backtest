# 📈 量化投资回测系统

专注于基本面分析的多资产量化投资回测平台，采用模块化设计和现代化技术栈，支持多数据源的基本面低频策略回测分析解决方案。

## 🎯 核心特性

- 🔧 **模块化扩展架构**: 支持多资产类型的基本面策略插件式扩展
- 💻 **统一数据管理**: 标准化数据源接口，支持股票、基金等多资产基本面数据
- 🗄️ **灵活存储设计**: 可配置存储后端，支持SQLite、MongoDB等多种数据库
- 📊 **基本面策略框架**: 专注于财务指标和估值指标的低频策略开发
- 📈 **专业级可视化**: HTML5+Chart.js生成高质量交互式图表
- 📋 **完整分析报告**: Excel数据表 + PNG图表 + 详细分析文档

## 🏗️ 可扩展系统架构

```
量化回测系统/
├── downloader/                # 数据管理核心模块
│   ├── __main__.py           # 统一模块入口
│   ├── cli.py                # 命令行界面
│   ├── router.py             # 多资产数据路由协调器
│   └── sources/              # 可扩展数据源插件
│       ├── a_stock/          # A股数据源实现
│       ├── [hk_stock/]       # 港股数据源(扩展)
│       ├── [us_stock/]       # 美股数据源(扩展)
│       └── [crypto/]         # 数字货币源(扩展)
├── strategies/               # 基本面策略模块
│   ├── low_ttm_pe_strategy.py # 低估值策略示例
│   ├── [value_strategy/]     # 价值投资策略(扩展)
│   ├── [quality_strategy/]   # 质量因子策略(扩展)  
│   └── [dividend_strategy/]  # 股息策略(扩展)
├── data/                     # 多资产数据存储
│   ├── a_stock/             # A股数据目录
│   ├── [hk_stock/]          # 港股数据目录(扩展)
│   └── [config/]            # 配置文件目录(扩展)
├── results/                  # 策略回测结果
│   └── [策略名_时间戳]/      # 统一输出格式
└── requirements.txt          # 依赖管理
```

**扩展设计说明**：
- `[方括号]` 表示可扩展模块，基于统一接口实现
- 数据源模块支持任意资产类型插件式扩展
- 策略模块支持任意策略类型的标准化实现

## 💡 系统设计理念

### 插件化扩展架构

**数据源插件化**: `downloader/sources/` 支持任意资产类型的数据源扩展，只需实现标准接口(初始化器、获取器、存储器、界面)即可集成新的数据源。

**基本面策略模块化**: `strategies/` 专注于基本面分析策略的开发，通过统一的回测接口和参数化配置，实现低频基本面策略的快速开发、测试和部署。

**存储后端可配置**: 支持SQLite、MongoDB等多种存储后端，可根据数据量和性能需求灵活选择。

**扩展接口标准化**: 所有扩展模块都基于统一的接口设计，确保新增功能与现有系统的无缝集成。

### 统一使用流程

1. **数据准备**: 运行 `python -m downloader` 进入多资产数据管理
   - 选择资产类型(A股/港股/美股/...) → 选择数据类型 → 自动下载和存储
2. **策略开发**: 基于标准框架开发或运行现有策略
   - 参数化配置 → 执行回测计算 → 生成完整分析报告  
3. **结果分析**: 统一的输出格式便于不同策略的横向对比
   - Excel详细数据 → 交互式图表 → 专业分析文档

## 📊 数据存储架构

### 多资产存储设计

采用 **分资产类型存储架构**，每种资产类型独立管理，便于扩展和维护：

```
data/
├── a_stock/              # A股数据存储
│   └── a_stock_data.db   # SQLite集成数据库
├── [hk_stock/]           # 港股数据存储(扩展)
├── [us_stock/]           # 美股数据存储(扩展)
└── [config/]             # 全局配置(扩展)
```

**存储后端可配置**: 每个数据源可选择最适合的存储方案：
- **SQLite**: 轻量级数据，适合个人使用和中小数据量
- **MongoDB**: 复杂结构数据，适合大数据量和分布式部署
- **其他**: 可扩展支持PostgreSQL、Redis等

### 数据获取机制

**插件化数据源**: 每个资产类型实现独立的数据获取器，支持：
- **多API容错**: 自动切换备用数据源，确保稳定性
- **智能重试**: 指数退避算法处理网络异常
- **数据规范化**: 统一不同API的数据格式和字段命名
- **增量更新**: 支持数据的增量更新和全量重建

## 🚀 快速开始

### 环境配置

#### 1. Python环境要求
```bash
# 确保Python版本 >= 3.8
python --version
```

#### 2. 依赖包安装
```bash
# 克隆或下载项目后，安装依赖
pip install -r requirements.txt

# 安装Playwright浏览器(图表生成必需)
playwright install chromium
```

### 系统使用

#### 1. 数据管理
```bash
# 启动数据管理模块
python -m downloader

# 按照菜单提示操作：
# 选择A股数据 → 下载股票清单 → 获取基本信息 → 更新K线数据 → 获取财务数据
```

#### 2. 策略回测
```bash
# 直接运行策略文件
python strategies/low_ttm_pe_strategy.py

# 或导入使用
from strategies.low_ttm_pe_strategy import run_backtest
run_backtest(min_market_cap=100, stock_count=10)
```

#### 3. 查看结果
回测完成后，结果自动保存到 `results/[策略名_时间戳]/` 目录：
- `backtest_results.xlsx` - Excel详细数据
- `net_value_chart.png` - 高质量净值图表  
- `README.md` - 策略分析报告

## 📊 量化策略开发

### 策略开发框架

#### 标准化策略接口

所有策略都基于统一的开发框架，支持：

**标准接口**: 统一的`run_backtest()`函数签名，参数化配置支持
```python
def run_backtest(
    # 通用参数
    start_date: str = "2020-01-01",
    end_date: str = "2025-06-30", 
    initial_capital: float = 1000000,
    # 策略特定参数
    **strategy_params
):
```

**数据访问**: 统一的数据库访问接口，支持多资产数据查询
**结果输出**: 标准化的三层报告格式(Excel + 图表 + 文档)
**参数管理**: 配置驱动的参数设计，支持批量测试和优化

#### 示例策略：A股低TTM PE轮动

**策略类型**: 价值投资策略(基本面低频)  
**适用资产**: A股主板市场  
**核心逻辑**: 基于TTM PE估值指标的月度轮动策略
**调仓频率**: 月度(低频策略)

```python
# 基本面策略参数
MIN_MARKET_CAP = 100.0    # 市值过滤(亿元)
STOCK_COUNT = 10          # 持仓数量  
TRANSACTION_COST = 0.0001 # 交易成本
```

**基本面策略扩展示例**: 
- 价值策略 (`strategies/value_strategy/`) - PB/PE/PEG等估值指标
- 质量策略 (`strategies/quality_strategy/`) - ROE/ROA/毛利率等质量指标
- 股息策略 (`strategies/dividend_strategy/`) - 股息率/分红稳定性等收益指标

## 🛠️ 技术特性

### 核心技术栈
- **数据获取**: 插件化数据源，支持多API容错和智能重试机制
- **数据存储**: 可配置存储后端(SQLite/MongoDB/PostgreSQL等)
- **数据处理**: pandas+numpy高效数据分析，支持大规模数据处理
- **图表生成**: HTML5+Chart.js现代化交互图表 + Playwright无头浏览器截图
- **报表输出**: openpyxl专业Excel报告 + Markdown结构化文档

### 系统依赖

```bash
# 核心依赖包
akshare >= 1.12.0      # A股数据获取
pandas >= 2.0.0        # 数据分析处理  
numpy >= 1.24.0        # 数值计算
openpyxl >= 3.1.0      # Excel报告生成
playwright >= 1.40.0   # 无头浏览器截图

# 可视化支持
matplotlib >= 3.7.0    # 传统图表(可选)
seaborn >= 0.12.0      # 统计图表(可选)

# 系统工具
tqdm >= 4.65.0         # 进度条显示
pymongo >= 4.0.0       # MongoDB扩展支持
```

## 📁 回测结果示例

每次策略回测自动生成时间戳命名的结果目录：

```
results/主板低TTM_PE策略_0910_2308/
├── backtest_results.xlsx      # Excel详细数据表
│   ├── Strategy_Overview      # 策略概览与业绩指标
│   ├── Stock_Selection        # 逐期选股详情
│   └── Period_Analysis        # 盈亏周期分析
├── net_value_chart.png        # 专业净值走势图表
└── README.md                  # 策略分析报告文档
```

## 🔄 扩展规划

### 多资产数据源扩展
基于插件化架构，可快速扩展支持：
- **港股市场**: 港股通、H股、红筹股数据源
- **美股市场**: NYSE、NASDAQ、ADR数据源  
- **基金市场**: 公募基金、ETF、私募基金数据源
- **衍生品市场**: 期货、期权、债券数据源
- **数字资产**: 加密货币、DeFi代币数据源

### 基本面策略类型扩展
- **价值投资策略**: PE/PB/PEG/PS等估值指标策略
- **质量投资策略**: ROE/ROA/ROIC/毛利率等盈利质量策略
- **成长投资策略**: 营收增长率/净利润增长率等成长性策略
- **股息投资策略**: 股息率/分红稳定性/股息增长率策略
- **财务健康策略**: 负债率/现金流/财务稳健性策略
- **基本面多因子**: 价值+质量+成长的综合基本面因子模型

**注**: 本系统专注于基本面分析的低频策略(月度/季度调仓)，不涉及技术分析、动量策略或高频交易策略。

### 平台功能增强
- **策略组合管理**: 多策略组合、风险预算、动态再平衡
- **风险管理系统**: VaR、ES、最大回撤等风险指标监控
- **归因分析**: Brinson归因、Fama-French归因等业绩归因分析
- **实盘对接**: 券商API对接、自动下单、实盘监控系统

## 🎯 项目定位

本系统致力于构建**基本面分析的多资产量化投资研究平台**，为价值投资者、基本面研究员和量化开发者提供：

- **教学工具**: 理解基本面量化投资的完整技术栈和实现原理
- **研究平台**: 跨资产的基本面策略验证和横向对比环境
- **开发框架**: 基于财务数据的基本面策略快速开发、测试和部署平台
- **扩展基础**: 支持自定义数据源和基本面策略类型的插件化开发框架

**策略定位**: 专注于月度/季度调仓的低频基本面策略，基于财务指标、估值指标和基本面数据进行投资决策。

## ⚠️ 重要声明

- **学术用途**: 本系统仅供教学和研究使用，不构成任何投资建议
- **风险提示**: 历史回测结果不代表未来表现，投资有风险，决策需谨慎
- **数据来源**: 所有数据来源于公开渠道，不保证数据的实时性和完整性

---

*📊 让量化分析成为投资决策的科学工具*
